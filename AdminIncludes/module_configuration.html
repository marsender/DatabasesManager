{**********************************************************************************}
{*                                                                                *}
{*    DatabasesManager - A Thelia 2 databases manager module                      *}
{*    Copyright (C) 2015 Jérôme BILLIRAS                                          *}
{*                                                                                *}
{*    This file is part of DatabasesManager.                                      *}
{*                                                                                *}
{*    DatabasesManager is free software: you can redistribute it and/or modify    *}
{*    it under the terms of the GNU General Public License as published by        *}
{*    the Free Software Foundation, either version 3 of the License, or           *}
{*    any later version.                                                          *}
{*                                                                                *}
{*    DatabasesManager is distributed in the hope that it will be useful,         *}
{*    but WITHOUT ANY WARRANTY; without even the implied warranty of              *}
{*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the               *}
{*    GNU General Public License for more details.                                *}
{*                                                                                *}
{*    You should have received a copy of the GNU General Public License           *}
{*    along with this program. If not, see <http://www.gnu.org/licenses/>.        *}
{*                                                                                *}
{**********************************************************************************}
<div class="general-block-decorator">
    <div class="row">
        <div class="col-xs-12 title title-without-tabs clearfix">
            {intl l="VIEW_TITLE" d="databasesmanager.ai"}
            {loop type="auth" name="auth-add" role="ADMIN" resource="admin.module" module="databasesmanager" access="CREATE"}
                <div class="pull-right">
                    <a class="btn btn-primary" href="#add-database-config-dialog" title="{intl l="ADD_BUTTON" d="databasesmanager.ai"}" data-toggle="modal"><span class="glyphicon glyphicon-plus"></span></a>
                </div>
            {/loop}
        </div>
    </div>

    {flash type="databasesmanager.delete.error"}
        <div class="col-xs-12 alert alert-danger">
            {$MESSAGE}
        </div>
    {/flash}

    {flash type="databasesmanager.delete.success"}
        <div class="col-xs-12 alert alert-success">
            {$MESSAGE}
        </div>
    {/flash}

    <div class="row">
        <div class="col-xs-12 table-responsive">
            <table id="databases-manager-config-list" class="table table-hover">
                <thead>
                    <tr>
                        <th>
                            {intl l="TABLE_HEAD_LABEL" d="databasesmanager.ai"}
                        </th>
                        <th>
                            {intl l="TABLE_HEAD_HOST" d="databasesmanager.ai"}
                        </th>
                        <th>
                            {intl l="TABLE_HEAD_USER" d="databasesmanager.ai"}
                        </th>
                        <th>
                            {intl l="TABLE_HEAD_PASS" d="databasesmanager.ai"}
                        </th>
                        <th>
                            {intl l="TABLE_HEAD_DB_NAME" d="databasesmanager.ai"}
                        </th>
                        <th>
                            {intl l="TABLE_HEAD_ACTION" d="databasesmanager.ai"}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {loop type="databases.manager.loop" name="databases.manager.loop"}
                        <tr>
                            <td>
                                {$LABEL}
                            </td>
                            <td>
                                {$HOST}
                            </td>
                            <td>
                                {$USER}
                            </td>
                            <td>
                                {$PASS}
                            </td>
                            <td>
                                {$DB_NAME}
                            </td>
                            <td>
                                <div class="btn-group btn-group-xs">
                                    {loop type="auth" name="auth-edit" role="ADMIN" resource="admin.module" module="databasesmanager" access="UPDATE"}
                                        <a class="btn btn-default" href="#edit-database-config-dialog" title="{intl l="ACTION_EDIT" d="databasesmanager.ai"}" data-toggle="modal" data-key="{$LABEL}" data-data="{$JSON}"><span class="glyphicon glyphicon-edit"></span></a>
                                    {/loop}
                                    {elseloop rel="auth-edit"}
                                        <span class="btn btn-default disabled" title="{intl l="ACTION_EDIT" d="databasesmanager.ai"}"><span class="glyphicon glyphicon-edit"></span></span>
                                    {/elseloop}

                                    {loop type="auth" name="auth-delete" role="ADMIN" resource="admin.module" module="databasesmanager" access="DELETE"}
                                        <a class="btn btn-default" href="#delete-database-config-dialog" title="{intl l="ACTION_DELETE" d="databasesmanager.ai"}" data-toggle="modal" data-key="{$LABEL}"><span class="glyphicon glyphicon-trash"></span></a>
                                    {/loop}
                                    {elseloop rel="auth-delete"}
                                        <span class="btn btn-default disabled" title="{intl l="ACTION_DELETE" d="databasesmanager.ai"}"><span class="glyphicon glyphicon-trash"></span></span>
                                    {/elseloop}
                                </div>
                            </td>
                        </tr>
                    {/loop}
                    {elseloop rel="databases.manager.loop"}
                        <tr>
                            <td class="text-center" colspan="6">
                                {intl l="NO_CONFIG" d="databasesmanager.ai"}
                            </td>
                        </tr>
                    {/elseloop}
                </tbody>
            </table>
        </div>
    </div>

    {loop type="auth" name="auth-add" role="ADMIN" resource="admin.module" module="databasesmanager" access="CREATE"}
        {form name="databases.manager.form.add"}
            <div id="add-database-config-dialog" class="modal fade{if $form_error} modal-force-show{/if}" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button class="close" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span></button>
                            <h3>
                                {intl l="MODAL_TITLE_ADD" d="databasesmanager.ai"}
                            </h3>
                        </div>

                        <form action="{url path="/admin/module/DatabasesManager/add"}" method="post" {form_enctype form=$form}>
                            <div class="modal-body">

                                {if $form_error_message}
                                    <div class="alert alert-danger">
                                        {$form_error_message}
                                    </div>
                                {/if}

                                {form_hidden_fields form=$form}

                                {form_field form=$form field="label"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label danger" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}

                                {form_field form=$form field="host"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}

                                {form_field form=$form field="user"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}

                                {form_field form=$form field="pass"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}

                                {form_field form=$form field="db_name"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}
                            </div>

                            <div class="modal-footer">
                                <button class="btn btn-default" type="button" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> {intl l="Cancel"}</button>
                                <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-check"></span> {intl l="Save"}</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        {/form}
    {/loop}

    {loop type="auth" name="auth-edit" role="ADMIN" resource="admin.module" module="databasesmanager" access="UPDATE"}
        {form name="databases.manager.form.edit"}
            <div id="edit-database-config-dialog" class="modal fade{if $form_error} modal-force-show{/if}" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button class="close" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span></button>
                            <h3>
                                {intl l="MODAL_TITLE_EDIT" d="databasesmanager.ai"}
                            </h3>
                        </div>

                        <form action="{url path="/admin/module/DatabasesManager/edit"}" method="post" {form_enctype form=$form}>
                            <div class="modal-body">

                                {if $form_error_message}
                                    <div class="alert alert-danger">
                                        {$form_error_message}
                                    </div>
                                {/if}

                                {form_hidden_fields form=$form}

                                {form_field form=$form field="label"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label danger" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}

                                {form_field form=$form field="host"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}

                                {form_field form=$form field="user"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}

                                {form_field form=$form field="pass"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}

                                {form_field form=$form field="db_name"}
                                    <div class="form-group{if $error} has-error{/if}">
                                        <label class="control-label" for="{$label_attr.for}">{intl l=$label d="databasesmanager.ai"}</label>
                                        <input id="{$label_attr.for}" class="form-control" type="text" name="{$name}" value="{$value}" {$attr}>
                                        {if $error}
                                            <div class="text-danger">
                                                {$message}
                                            </div>
                                        {/if}
                                    </div>
                                {/form_field}
                            </div>

                            <div class="modal-footer">
                                <button class="btn btn-default" type="button" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> {intl l="Cancel"}</button>
                                <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-edit"></span> {intl l="Update"}</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        {/form}
    {/loop}

    {loop type="auth" name="auth-delete" role="ADMIN" resource="admin.module" module="databasesmanager" access="DELETE"}
        <div id="delete-database-config-dialog" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button class="close" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span></button>
                        <h3>
                            {intl l="MODAL_TITLE_DELETE" d="databasesmanager.ai"}
                        </h3>
                    </div>

                    <div id="databases-manager-delete-modal-body" class="modal-body" data-confirm-string="{intl l="MODAL_DELETE_CONFIRM" d="databasesmanager.ai"}">
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-default" type="button" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> {intl l="Cancel"}</button>
                        <button id="databases-manager-delete-valid" class="btn btn-primary" type="button" data-href="{url path="/admin/module/DatabasesManager/delete/%label"}"><span class="glyphicon glyphicon-trash"></span> {intl l="Delete"}</button>
                    </div>
                </div>
            </div>
        </div>
    {/loop}

</div>
